<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: sans-serif;
      padding: 16px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h3>Overlay Settings</h3>
  <label>Font Size:
    <input type="number" id="fontSize" value="42" />
  </label>
  <label>Primary WebSocket URL:
      <span id="wsstatus1"
        style="display: inline-block; width: 10px; height: 10px; background-color: green; border-radius: 50%; margin-left: 4px;">
  </span>
    <input type="text" id="wsUrl1" value="ws://localhost:6677/api/ws/text/origin" />
  </label>
  <label>Secondary WebSocket URL:
      <span id="wsstatus2"
        style="display: inline-block; width: 10px; height: 10px; background-color: green; border-radius: 50%; margin-left: 4px;">
  </span>
    <input type="text" id="wsUrl2" value="ws://localhost:6677" />
  </label>

  <label>Hide Main Box on Startup:
    <input type="checkbox" id="hideOnStartup" />
  </label>

  <label>Enable Magpie Compatibility
    <input type="checkbox" id="magpieCompatibility" />
  </label>

  <!-- <label>
    (Experimental) Enable Manual Mode (Shift + Space to show/hide)
    <input type="checkbox" id="enableManualMode" disabled />
    <br/>
    <small>This mode allows you to manually toggle the overlay visibility using the following hotkey. Note that this is experimental and may not work perfectly with all applications.</small>
  </label>

  <label>Show Overlay Hotkey
    <input type="text" id="showHotkey" value="Shift + Space" pattern="^(\s*\w+\s*\+\s*)*\w+\s*$" title="Enter a valid hotkey (e.g., Shift + Space)" />
    <small>Format: Modifier + Key (e.g., Shift + Space)</small>
  </label> -->

  <script>
    const { ipcRenderer } = require("electron");
    document.getElementById("fontSize").addEventListener("input", (event) => {
      const newSize = event.target.value;
      ipcRenderer.send("fontsize-changed", newSize)
    })
    document.getElementById("wsUrl1").addEventListener("blur", (event) => {
      ipcRenderer.send("weburl1-changed", event.target.value)
    })
    document.getElementById("wsUrl2").addEventListener("blur", (event) => {
      ipcRenderer.send("weburl2-changed", event.target.value)
    })
    document.getElementById("hideOnStartup").addEventListener("change", (event) => {
      ipcRenderer.send("hideonstartup-changed", event.target.checked)
    })
    // document.getElementById("magpieCompatibility").addEventListener("change", (event) => {
    //   ipcRenderer.send("magpieCompatibility-changed", event.target.checked)
    // })

    // document.getElementById("enableManualMode").addEventListener("change", (event) => {
    //   ipcRenderer.send("manualmode-changed", event.target.checked)
    // })
    // document.getElementById("showHotkey").addEventListener("blur", (event) => {
    //   const newHotkey = event.target.value;
    //   if (validateHotkey(newHotkey)) {
    //     ipcRenderer.send("showHotkey-changed", newHotkey)
    //   } else {
    //     ipcRenderer.send("request-current-settings");
    //   }
    // })

    function validateHotkey(hotkey) {
      // Basic validation: check that it's not just modifier, needs at least one key
      const modifiers = ["Shift", "Ctrl", "Alt", "Meta"];
      const parts = hotkey.split("+").map(part => part.trim());
      const hasModifier = parts.some(part => modifiers.includes(part));
      const hasKey = parts.some(part => !modifiers.includes(part) && part.length > 0);
      return hasKey;
    }

    ipcRenderer.on("preload-settings", (event, {settings, websocketStates}) => {
      const {fontSize, weburl1, weburl2, hideOnStartup, magpieCompatibility, enableManualMode, showHotkey} = settings;
      document.getElementById("fontSize").value = fontSize;
      document.getElementById("wsUrl1").value = weburl1;
      // document.getElementById("enableManualMode").checked = enableManualMode;
      // document.getElementById("showHotkey").value = showHotkey;
      document.getElementById("wsUrl2").value = weburl2;
      document.getElementById("wsstatus1").style.backgroundColor = websocketStates.ws1 ? "green" : "red"
      document.getElementById("wsstatus2").style.backgroundColor = websocketStates.ws2 ? "green" : "red"
      document.getElementById("hideOnStartup").checked = hideOnStartup;
      document.getElementById("magpieCompatibility").checked = magpieCompatibility;
    })
    ipcRenderer.on("websocket-closed", (event, type) => {
      if (type == "ws1") {
        document.getElementById("wsstatus1").style.backgroundColor = "red"
      } else {
        document.getElementById("wsstatus2").style.backgroundColor = "red"
      }
    })
    ipcRenderer.on("websocket-opened", (event, type) => {
      if (type == "ws1") {
        document.getElementById("wsstatus1").style.backgroundColor = "green"
      } else {
        document.getElementById("wsstatus2").style.backgroundColor = "green"
      }
    })
  </script>
</body>
</html>
